<section class="container">
  <h1>Solicitudes (Admin)</h1>

  <!-- Filtros: DNI y Estado. (ngSubmit) llama a buscar().  -->
  <form class="filters" (ngSubmit)="buscar()">
    <!-- DNI del solicitante (nuestro campo solicitanteUser guarda el dni) -->
    <input [(ngModel)]="dni" name="dni" placeholder="DNI del solicitante">

    <!-- Selector de estado con opción 'Todos' (cadena vacía) -->
    <select [(ngModel)]="estado" name="estado">
      <option value="">Todos los estados</option>
      <option value="pendiente">Pendiente</option>
      <option value="aprobada">Aprobada</option>
      <option value="rechazada">Rechazada</option>
      <option value="cancelada">Cancelada</option>
    </select>

    <button type="submit">Buscar</button>
    <button type="button" (click)="limpiar()">Limpiar</button>
  </form>

  <!-- Estados de carga y error -->
  @if (loading) { <p>Cargando…</p> }
  @if (!loading && error) { <p>{{ error }}</p> }

  <!-- Tabla principal: se muestra solo si hay datos y no hay error -->
  @if (!loading && !error && data.length > 0) {
    <table>
      <thead>
        <tr>
          <th>Fecha</th>
          <th>DNI</th>
          <th>Animal</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <!-- Recorremos solicitudes con el control flow nuevo (@for) -->
        @for (s of data; track s.id) {
          <tr>
            <!-- DatePipe formatea ISO a legible -->
            <td>{{ s.fecha | date:'short' }}</td>
            <!-- En solicitanteUser guardamos el DNI -->
            <td>{{ s.solicitanteUser }}</td>
            <!-- Mostramos el id del animal; más adelante podés joinear para ver el nombre -->
            <td>#{{ s.animalId }}</td>

            <!-- Clase por estado para estilizar con CSS -->
            <td class="estado {{s.estado}}">{{ s.estado }}</td>

            <td class="acciones">
              <!-- Solo si está 'pendiente' mostramos los botones de moderación -->
              @if (s.estado === 'pendiente') {
                <button (click)="aprobar(s)">Aprobar</button>
                <button (click)="rechazar(s)">Rechazar</button>
              }
            </td>
          </tr>
        }
      </tbody>
    </table>
  }

  <!-- Estado vacío -->
  @if (!loading && !error && data.length === 0) {
    <p>Sin resultados.</p>
  }
</section>
