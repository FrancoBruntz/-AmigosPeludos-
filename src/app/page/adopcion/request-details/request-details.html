<div class="container">
  <h2>Detalle de solicitud</h2>

  <!-- Cargando -->
  @if (isLoading) {
    <p class="loading">Cargando datos de la solicitud...</p>
  } @else {

    <!-- Error -->
    @if (errorMessage) {

      <p class="error">{{ errorMessage }}</p>
      <button class="btn-back" (click)="goBack()">
        ⬅ Volver al listado
      </button>

    } @else if (solicitud) {

      <section class="detail-card">

        <!-- INFO GENERAL -->
        <div class="detail-block">
          <h3>Información general</h3>

          <p><strong>ID solicitud:</strong> {{ solicitud.id }}</p>
          <p><strong>ID animal:</strong> {{ solicitud.animalId }}</p>
          <p><strong>DNI solicitante:</strong> {{ solicitud.solicitanteUser }}</p>

          <p>
            <strong>Fecha:</strong>
            {{ solicitud.fecha | date:'dd/MM/yyyy HH:mm' }}
          </p>

          <p>
            <strong>Estado:</strong>
            <span class="estado-badge {{ solicitud.estado }}">
              {{ solicitud.estado }}
            </span>
          </p>
        </div>

        <!-- DATOS DE ADOPCIÓN (LO QUE LLENÓ EN EL FORM) -->
        <div class="detail-block">
          <h3>Datos de adopción</h3>

          <p>
            <strong>Tipo de vivienda:</strong>
            {{ viviendaLabel(solicitud.tipoVivienda) }}
          </p>

          <p>
            <strong>¿Tiene patio?</strong>
            {{ boolToText(solicitud.tienePatio) }}
          </p>

          <p>
            <strong>¿Tiene otras mascotas?</strong>
            {{ boolToText(solicitud.tieneMascotas) }}
          </p>

          @if (solicitud.tieneMascotas && solicitud.detalleMascotas) {
            <p>
              <strong>Detalle de mascotas:</strong>
              {{ solicitud.detalleMascotas }}
            </p>
          }

          <p>
            <strong>¿Vive con niños?</strong>
            {{ boolToText(solicitud.viveConNinos) }}
          </p>

          <p>
            <strong>¿Acepta compromiso de cuidado?</strong>
            {{ boolToText(solicitud.aceptaCompromiso) }}
          </p>
        </div>

        <!-- MENSAJE DEL SOLICITANTE -->
        @if (solicitud.mensaje) {
          <div class="detail-block">
            <h3>Mensaje del solicitante</h3>
            <p>{{ solicitud.mensaje }}</p>
          </div>
        }

        <!-- COMENTARIOS DEL ADMIN -->
        <div class="detail-block">
          <h3>Comentarios del administrador</h3>

          @if (solicitud.comentarios) {
            <p>{{ solicitud.comentarios }}</p>
          } @else {
            <p><em>Sin comentarios registrados.</em></p>
          }
        </div>

      </section>

      <!-- BOTONES PARA ADMIN (solo si la solicitud está pendiente) -->
      @if (auth.isAdmin() && solicitud.estado === 'pendiente') {
        <div class="acciones-admin">
          <button class="btn-aprobar" (click)="openModal('aprobar')">
            ✓ Aprobar
          </button>

          <button class="btn-rechazar" (click)="openModal('rechazar')">
            ✕ Rechazar
          </button>
        </div>
      }

      <button class="btn-back" (click)="goBack()">
        ⬅ Volver al listado
      </button>

    }

  }
</div>

<!-- MODAL DE COMENTARIOS PARA APROBAR / RECHAZAR -->
@if (showComentariosModal && solicitud) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">

      <h2>
        {{ modalAccion === 'aprobar' ? 'Aprobar solicitud' : 'Rechazar solicitud' }}
      </h2>

      <div class="modal-info">
        <p><strong>Solicitante (DNI):</strong> {{ solicitud.solicitanteUser }}</p>
        <p><strong>ID animal:</strong> {{ solicitud.animalId }}</p>
        <p><strong>Fecha:</strong> {{ solicitud.fecha | date:'short' }}</p>
      </div>

      <div class="modal-form">
        <label for="comentarios">Comentarios (opcional):</label>
        <textarea
          id="comentarios"
          [(ngModel)]="comentariosText"
          rows="4"
          placeholder="Agrega comentarios para el adoptante..."
        ></textarea>
      </div>

      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeModal()">Cancelar</button>

        <button
          class="btn-confirm"
          [class.btn-aprobar]="modalAccion === 'aprobar'"
          [class.btn-rechazar]="modalAccion === 'rechazar'"
          (click)="confirmarAccion()"
        >
          {{ modalAccion === 'aprobar' ? 'Aprobar' : 'Rechazar' }}
        </button>
      </div>

    </div>
  </div>
}