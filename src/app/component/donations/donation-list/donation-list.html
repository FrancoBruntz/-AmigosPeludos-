<div class="container">
  <h2>Historial de donaciones (Admin)</h2>

  @if (errorMessage) {

    <div class="error">
      {{ errorMessage }}
    </div>

  } @else {

    <!-- PANEL BLANCO CON FILTROS + TABLA -->
    <div class="donations-panel">

      <!-- FILTROS -->
      <div class="filters">

        <!-- Método -->
        <div>
          <label for="methodAdmin">Método:</label>
          <select
            id="methodAdmin"
            [(ngModel)]="selectedMethod"
            (change)="applyFilter()"
          >
            <option value="Todas">Todas</option>
            <option value="Tarjeta">Tarjeta</option>
            <option value="Transferencia">Transferencia</option>
            <option value="Efectivo">Efectivo</option>
          </select>
        </div>

        <!-- userId -->
        <div>
          <label for="userIdFilter">Usuario (userId):</label>
          <input
            id="userIdFilter"
            type="text"
            [(ngModel)]="userIdFilter"
            (input)="applyFilter()"
            placeholder="Ej: 12345678"
          >
        </div>

        <!-- Monto mínimo -->
        <div>
          <label for="minAmount">Monto mínimo:</label>
          <input
            id="minAmount"
            type="number"
            [(ngModel)]="minAmount"
            (input)="applyFilter()"
            placeholder="Ej: 1000"
          >
        </div>

        <!-- Fecha desde 
        <div>
          <label for="dateFrom">Desde:</label>
          <input
            id="dateFrom"
            type="date"
            [(ngModel)]="dateFrom"
            (change)="applyFilter()"
          >
        </div>

        Fecha hasta --><!-- 
        <div>
          <label for="dateTo">Hasta:</label>
          <input
            id="dateTo"
            type="date"
            [(ngModel)]="dateTo"
            (change)="applyFilter()"
          >
        </div>
        -->

      </div>

      @if (filteredDonations.length === 0) {

        <p class="empty">No hay donaciones que coincidan con el filtro.</p>

      } @else {

        <p class="total">
          Total donado (filtro actual):
          <strong>{{ getTotal() | currency:'ARS':'symbol':'1.0-0' }}</strong>
        </p>

        <table class="donations-table">
          <thead>
            <tr>
              <th>Usuario (userId)</th>
              <th>Monto</th>
              <th>Método</th>
              <th>Fecha</th>
              <th>Mensaje</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (d of filteredDonations; track d.id) {
              <tr>
                <td>{{ d.userId }}</td>

                <td>{{ d.amount | currency:'ARS':'symbol':'1.0-0' }}</td>

                <td>{{ d.method | titlecase }}</td>

                <td>{{ d.date | date:'dd/MM/yyyy' }}</td>

                <td>{{ d.message }}</td>

                <td class="acciones">
                  <a [routerLink]="['/admin/donaciones', d.id]">
                    Ver detalle
                  </a>
                </td>
              </tr>
            }
          </tbody>
        </table>

      }

    </div> <!-- /donations-panel -->

  }
</div>