<div id="contenedorForm">
<h2>Realizar donaci贸n</h2>

<div class="info-banner">
  <h3>驴Para qu茅 usamos las donaciones?</h3>
  <p>
    Con tu donaci贸n ayud谩s a cubrir:
  </p>
  <ul>
    <li>ィ Comida y alimentaci贸n diaria</li>
    <li> Pipetas, desparasitantes y medicaci贸n</li>
    <li> Gastos veterinarios y urgencias</li>
    <li> Mantenimiento del refugio</li>
  </ul>
</div>

<form [formGroup]="form" (ngSubmit)="onSubmit()">

  <!-- MONTO -->
  <div class="form-group" [class.invalid]="isInvalid('amount')">
    <label for="amount">Monto a donar ($)</label>
    <input 
      type="number" 
      id="amount" 
      formControlName="amount" 
      placeholder="Ej: 2000"
    >

    @if (getControl('amount')?.touched && getControl('amount')?.errors) {
      @if (hasError('amount', 'required')) {
        <small class="error">El monto es obligatorio.</small>
      }
      @if (hasError('amount', 'min')) {
        <small class="error">Debe ser mayor o igual a $100.</small>
      }
    }
  </div>

  <!-- MTODO DE PAGO -->
  <div class="form-group" [class.invalid]="isInvalid('method')">
    <label for="method">M茅todo de pago</label>
    <select id="method" formControlName="method">
      <option value="" disabled>Selecciona una opci贸n</option>

      @for (m of methods; track $index) {
        <option [value]="m">{{ m }}</option>
      }
    </select>

    @if (getControl('method')?.touched && getControl('method')?.invalid) {
      <small class="error">Eleg铆 un m茅todo de pago.</small>
    }
  </div>

  <!-- TARJETA -->
  @if (isCardMethod()) {
    <fieldset class="section">
      <legend>Datos de la tarjeta</legend>

      <div class="form-group">
        <label for="cardNumber">N煤mero de tarjeta</label>
        <input 
          id="cardNumber"
          type="text"
          formControlName="cardNumber"
          placeholder="XXXX-XXXX-XXXX-XXXX"
        >
      </div>

      <div class="form-group">
        <label for="cardHolder">Titular</label>
        <input 
          id="cardHolder"
          type="text"
          formControlName="cardHolder"
          placeholder="Nombre y apellido"
        >
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="expiration">Vencimiento</label>
          <input 
            id="expiration"
            type="text"
            formControlName="expiration"
            placeholder="MM/AA"
          >
        </div>

        <div class="form-group">
          <label for="cvv">CVV</label>
          <input 
            id="cvv"
            type="password"
            formControlName="cvv"
            maxlength="4"
            placeholder="***"
          >
        </div>
      </div>
    </fieldset>
  }

  <!-- TRANSFERENCIA -->
 @if (isTransferMethod()) {
  <fieldset class="section">
    <legend>Datos para transferencia</legend>

    <p>
      Realiz谩 tu transferencia utilizando los siguientes datos del refugio:
    </p>

    <div class="transfer-info-box">
      <p><strong>Alias:</strong> animales.peludos.refugio</p>
      <p><strong>CBU:</strong> 0000003100045678912345</p>
    </div>

    <p>
      Una vez realizada la transferencia, no olvides guardar el comprobante.
    </p>
  </fieldset>
}

  <!-- MENSAJE -->
  <div class="form-group" [class.invalid]="isInvalid('message')">
    <label for="message">Mensaje (opcional)</label>
    <textarea
      id="message"
      rows="3"
      formControlName="message"
      placeholder="Escrib铆 un mensaje para el refugio..."
    ></textarea>

    @if (hasError('message', 'maxlength')) {
      <small class="error">M谩ximo 200 caracteres.</small>
    }
  </div>

  <!-- RESUMEN DE VALIDACIN GENERAL -->
  @if (form.invalid && form.touched) {
    <p class="form-error-summary">
      Revis谩 los campos marcados en rojo antes de continuar.
    </p>
  }

  <!-- BOTN -->
  <button type="submit" [disabled]="form.invalid">
    Confirmar donaci贸n
  </button>

</form>

<!-- PREVIEW / RESUMEN DE PAGO -->
@if (form.valid) {
  <section class="preview-card">
    <h3>Resumen de tu donaci贸n</h3>

    <p>
      Vas a donar 
      <strong>{{ getControl('amount')?.value | currency:'ARS':'symbol':'1.0-0' }}</strong>
      mediante 
      <strong>{{ getControl('method')?.value | titlecase }}</strong>.
    </p>

    @if (isCardMethod()) {
      <p>
        La donaci贸n se procesar谩 con la tarjeta 
        <strong>
          terminada en {{
            (getControl('cardNumber')?.value || '').slice(-4)
          }}
        </strong>.
      </p>
      @if (getControl('cardHolder')?.value) {
        <p>
          Titular: 
          <strong>{{ getControl('cardHolder')?.value | titlecase }}</strong>
        </p>
      }
    }

    @if (getControl('method')?.value === 'Efectivo') {
      <p>
        Podr谩s realizar la donaci贸n en efectivo 
        al acercarte al refugio.
      </p>
    }

    @if (getControl('message')?.value) {
      <p>
        Tu mensaje: 
        <em>"{{ getControl('message')?.value }}"</em>
      </p>
    }
  </section>
}

</div>